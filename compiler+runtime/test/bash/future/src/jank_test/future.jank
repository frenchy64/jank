(ns jank-test.future)

(defn -main []
  (dotimes [_ 100000]
    (let [atm (atom [])
          ; conjing strings gives Exception: invalid object type: unknown raw value 72
          ; conjing symbols gives
          ; - zsh: segmentation fault 
          ; - zsh: bus error
          a (future (swap! atm conj (gensym "a")))
          _ (swap! atm conj "between")
          ;; b fires twice! a not at all.
          b (future (swap! atm conj (gensym "b")))]
      ;(swap! atm conj "after")
      @a
      @b
      (prn @atm "DONE"))))
